<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>測量ARナビ</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false;">
        
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        // Pythonからデータを取ってくる
        fetch('/api/points')
            .then(response => response.json())
            .then(points => {
                const scene = document.querySelector('a-scene');

                points.forEach(p => {
                    // 各座標に「ピン」を作成
                    const entity = document.createElement('a-text');
                    entity.setAttribute('value', p.name);
                    entity.setAttribute('scale', '15 15 15');
                    entity.setAttribute('look-at', '[gps-camera]');
                    entity.setAttribute('align', 'center');
                    entity.setAttribute('color', 'orange');
                    
                    // 緯度・経度を設定
                    entity.setAttribute('gps-entity-place', `latitude: ${p.lat}; longitude: ${p.lon};`);

                    scene.appendChild(entity);
                });
                console.log("ARピンの配置完了:", points.length, "地点");
            });
    </script>
</body>
</html>